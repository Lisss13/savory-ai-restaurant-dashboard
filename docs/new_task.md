# Техническое задание: Панель пользователя — Управление подписками

## 1. Общее описание

Реализовать в панели пользователя (администратора организации) раздел для просмотра и управления подпиской организации.

### 1.1 Контекст

- При регистрации пользователя автоматически создаётся **пробная подписка на 1 месяц**
- Подписка привязана к организации (не к пользователю)
- У организации может быть только одна активная подписка
- История подписок сохраняется в системе


## 2. Функциональные требования

### 2.1 Просмотр текущей подписки

**Отображаемая информация:**
- Статус подписки (активна/неактивна/истекла)
- Дата начала подписки
- Дата окончания подписки
- Количество оставшихся дней (`daysLeft`)
- Период подписки (в месяцах)

### 2.2 Предупреждения об истечении подписки

**Логика уведомлений:**

| Условие | Действие |
|---------|----------|
| `daysLeft <= 7` | Красный баннер "Подписка истекает через X дней" |
| `daysLeft <= 14` | Жёлтый баннер "Подписка скоро истечёт" |
| `daysLeft == 0` и `isActive == true` | Красный баннер "Подписка истекла" |
| `isActive == false` | Красный баннер "Подписка деактивирована" |

**Глобальное уведомление:**
- При `daysLeft <= 7` показывать уведомление в шапке приложения на всех страницах

### 2.3 История подписок

**Отображение:**
- Таблица всех подписок организации (текущих и прошлых)
- Сортировка: новые первыми

**Поля таблицы:**

| Поле | Описание |
|------|----------|
| Период | Количество месяцев |
| Дата начала | StartDate |
| Дата окончания | EndDate |
| Статус | Активна / Неактивна / Истекла |
| Дата создания | CreatedAt |


---

## 3. API Endpoints (существующие)

### 3.1 Для пользователя (требуют JWT)

| Метод | Endpoint | Описание |
|-------|----------|----------|
| GET | `/subscriptions/organization/:id` | Все подписки организации |
| GET | `/subscriptions/organization/:id/active` | Активная подписка |

### 3.2 Response формат

**SubscriptionResp:**
```json
{
  "id": 1,
  "createdAt": "2025-12-01T10:00:00Z",
  "organization": {
    "id": 1,
    "name": "Ресторан Пушкин",
    "phone": "+79001234567"
  },
  "period": 1,
  "startDate": "2025-12-01T00:00:00Z",
  "endDate": "2026-01-01T00:00:00Z",
  "isActive": true,
  "daysLeft": 30
}
```

---

## 4. Состояния подписки

```
+──────────────+     +──────────────+     +──────────────+
│   Активна    │────>│   Истекла    │────>│ Деактивиро-  │
│  isActive:   │     │  isActive:   │     │    вана      │
│    true      │     │    true      │     │  isActive:   │
│  daysLeft>0  │     │  daysLeft=0  │     │    false     │
+──────────────+     +──────────────+     +──────────────+
       │                    │
       │    [Продлить]      │
       v                    │
+──────────────+            │
│  Продлена    │<───────────+
│  (новая дата │    [Создать новую - только admin]
│  окончания)  │
+──────────────+
```

---

### 5.2 Шапка приложения (Header)

При `daysLeft <= 7`:
```
+─────────────────────────────────────────────────────────+
│ ! Ваша подписка истекает через 5 дней [Продлить]        │
+─────────────────────────────────────────────────────────+
```

---

## 6. Обработка ошибок

| Код | Сообщение | Действие |
|-----|-----------|----------|
| 401 | Unauthorized | Редирект на логин |
| 403 | Forbidden | "Нет доступа к подписке" |
| 404 | Subscription not found | "Подписка не найдена" |
| 400 | Cannot extend inactive subscription | "Невозможно продлить неактивную подписку" |

---

## 7. Технические требования

### 7.1 Кэширование

- Кэшировать данные подписки на клиенте
- Инвалидировать кэш после продления

### 7.2 Polling/WebSocket

- Проверять статус подписки при входе в приложение
- Обновлять `daysLeft` каждый день (или при открытии приложения)

### 7.3 Локализация

Поддержка форматов дат:
- RU: `01.12.2025`
- EN: `Dec 01, 2025`

---

## 9. Критерии приёмки

1. Пользователь видит информацию о текущей подписке
2. Отображается количество оставшихся дней
3. Показываются предупреждения при `daysLeft <= 7`
4. Пользователь может продлить активную подписку
5. Отображается история подписок
6. Корректная обработка всех состояний подписки
7. Адаптивная вёрстка (mobile/desktop)
